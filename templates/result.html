{% extends 'base.html' %}
{% block title %}Risk Analysis - CardioPredict AI{% endblock %}
{% block content %}

<div class="card border-0 shadow-sm text-center mb-4" style="border-radius: 16px;">
    <div class="card-body p-4">
        <h1 class="display-6 fw-bold mb-2">Cardiovascular Risk Analysis</h1>
        <p class="text-body-secondary mb-0">
            <i class="fas fa-robot me-2"></i>Model: XGBoost | Oct 24, 2025 • 14:02 PM
        </p>
    </div>
</div>

<!-- Prediction Result -->
{% set risk_prob = prob | float %}
<div class="card border-0 shadow mb-4"
    style="border-radius: 16px; border-left: 5px solid {% if risk_prob < 30 %}#198754{% elif risk_prob < 60 %}#ffc107{% else %}#dc3545{% endif %} !important;">
    <div class="card-body p-5 text-center">
        <span
            class="badge {% if risk_prob < 30 %}text-bg-success{% elif risk_prob < 60 %}text-bg-warning{% else %}text-bg-danger{% endif %} rounded-pill px-4 py-3 fs-5 fw-bold mb-4">
            {% if risk_prob < 30 %} <i class="fas fa-check-circle me-2"></i>
                {% elif risk_prob < 60 %} <i class="fas fa-exclamation-triangle me-2"></i>
                    {% else %}
                    <i class="fas fa-exclamation-circle me-2"></i>
                    {% endif %}
                    {{ prediction_text }}
        </span>

        <div class="my-4">
            <div
                class="display-1 fw-bold {% if risk_prob < 30 %}text-success{% elif risk_prob < 60 %}text-warning{% else %}text-danger{% endif %}">
                {{ prob }}%
            </div>
            <p class="fs-5 text-body-secondary fw-semibold">Prediction Confidence</p>
        </div>

        <p class="text-body-secondary">
            <i class="fas fa-info-circle me-2"></i>
            Based on XGBoost analysis of vitals, lifestyle, BMI and pulse pressure
        </p>
    </div>
</div>

<!-- Metrics -->
<div class="row g-3 mb-4">
    <div class="col-md-4">
        <div class="card border-0 shadow-sm text-center h-100" style="border-radius: 12px;">
            <div class="card-body p-4">
                <i class="fas fa-brain fs-1 mb-3" style="color: #0066FF;"></i>
                <h6 class="fw-bold">Processing Time</h6>
                <p class="text-body-secondary mb-0">420ms</p>
            </div>
        </div>
    </div>
    <div class="col-md-4">
        <div class="card border-0 shadow-sm text-center h-100" style="border-radius: 12px;">
            <div class="card-body p-4">
                <i class="fas fa-bullseye fs-1 text-success mb-3"></i>
                <h6 class="fw-bold">Model Accuracy</h6>
                <p class="text-body-secondary mb-0">73.32%</p>
            </div>
        </div>
    </div>
    <div class="col-md-4">
        <div class="card border-0 shadow-sm text-center h-100" style="border-radius: 12px;">
            <div class="card-body p-4">
                <i class="fas fa-database fs-1 text-info mb-3"></i>
                <h6 class="fw-bold">Factors Analyzed</h6>
                <p class="text-body-secondary mb-0">14 Features</p>
            </div>
        </div>
    </div>
</div>

<!-- Recommendations -->
<div class="card border-0 shadow-sm mb-4" style="border-radius: 12px;">
    <div class="card-body p-4">
        <h4 class="fw-bold mb-4">
            <i class="fas fa-notes-medical me-2" style="color: #0066FF;"></i>
            Personalized Recommendations
        </h4>

        {% if risk_prob < 30 %} <div class="alert alert-success" role="alert">
            <h6 class="fw-bold mb-2"><i class="fas fa-thumbs-up me-2"></i>Low Risk Category</h6>
            <p class="mb-0">Your cardiovascular risk appears low. Continue your healthy lifestyle!</p>
    </div>

    <h6 class="fw-bold text-success mb-3"><i class="fas fa-check-circle me-2"></i>Maintenance Tips</h6>
    <div class="list-group list-group-flush">
        <div class="list-group-item bg-success bg-opacity-10 border-start border-success border-4">
            <i class="fas fa-running me-2 text-success"></i>
            <strong>Exercise:</strong> 150+ minutes moderate activity weekly
        </div>
        <div class="list-group-item bg-success bg-opacity-10 border-start border-success border-4">
            <i class="fas fa-apple-alt me-2 text-success"></i>
            <strong>Diet:</strong> Fruits, vegetables, whole grains, lean proteins
        </div>
        <div class="list-group-item bg-success bg-opacity-10 border-start border-success border-4">
            <i class="fas fa-heartbeat me-2 text-success"></i>
            <strong>Checkups:</strong> Annual health screenings
        </div>
        <div class="list-group-item bg-success bg-opacity-10 border-start border-success border-4">
            <i class="fas fa-bed me-2 text-success"></i>
            <strong>Sleep:</strong> 7-9 hours nightly
        </div>
    </div>

    {% elif risk_prob < 60 %} <div class="alert alert-warning" role="alert">
        <h6 class="fw-bold mb-2"><i class="fas fa-exclamation-triangle me-2"></i>Moderate Risk</h6>
        <p class="mb-0">Attention needed. These recommendations can reduce your risk.</p>
</div>

<h6 class="fw-bold text-warning mb-3"><i class="fas fa-clipboard-list me-2"></i>Action Steps</h6>
<div class="list-group list-group-flush">
    <div class="list-group-item bg-warning bg-opacity-10 border-start border-warning border-4">
        <i class="fas fa-user-md me-2 text-warning"></i>
        <strong>Doctor:</strong> Schedule cardiovascular evaluation
    </div>
    <div class="list-group-item bg-warning bg-opacity-10 border-start border-warning border-4">
        <i class="fas fa-heartbeat me-2 text-warning"></i>
        <strong>Monitor:</strong> Check BP weekly
    </div>
    <div class="list-group-item bg-warning bg-opacity-10 border-start border-warning border-4">
        <i class="fas fa-vial me-2 text-warning"></i>
        <strong>Tests:</strong> Lipid profile, glucose tests
    </div>
    <div class="list-group-item bg-warning bg-opacity-10 border-start border-warning border-4">
        <i class="fas fa-dumbbell me-2 text-warning"></i>
        <strong>Activity:</strong> 30-45 min exercise most days
    </div>
    <div class="list-group-item bg-warning bg-opacity-10 border-start border-warning border-4">
        <i class="fas fa-ban me-2 text-warning"></i>
        <strong>Diet:</strong> Reduce salt, fats, processed foods
    </div>
</div>

{% else %}
<div class="alert alert-danger" role="alert">
    <h6 class="fw-bold mb-2"><i class="fas fa-exclamation-circle me-2"></i>High Risk</h6>
    <p class="mb-0">Immediate attention required. Seek medical advice promptly.</p>
</div>

<h6 class="fw-bold text-danger mb-3"><i class="fas fa-hospital me-2"></i>Urgent Actions</h6>
<div class="list-group list-group-flush">
    <div class="list-group-item bg-danger bg-opacity-10 border-start border-danger border-4">
        <i class="fas fa-ambulance me-2 text-danger"></i>
        <strong>Immediate:</strong> See cardiologist ASAP
    </div>
    <div class="list-group-item bg-danger bg-opacity-10 border-start border-danger border-4">
        <i class="fas fa-notes-medical me-2 text-danger"></i>
        <strong>Testing:</strong> ECG, echocardiogram, stress test
    </div>
    <div class="list-group-item bg-danger bg-opacity-10 border-start border-danger border-4">
        <i class="fas fa-pills me-2 text-danger"></i>
        <strong>Medication:</strong> Discuss with doctor
    </div>
    <div class="list-group-item bg-danger bg-opacity-10 border-start border-danger border-4">
        <i class="fas fa-heartbeat me-2 text-danger"></i>
        <strong>Monitor:</strong> Daily BP logging
    </div>
    <div class="list-group-item bg-danger bg-opacity-10 border-start border-danger border-4">
        <i class="fas fa-apple-alt me-2 text-danger"></i>
        <strong>Diet:</strong> Heart-healthy (low sodium, high fiber)
    </div>
    <div class="list-group-item bg-danger bg-opacity-10 border-start border-danger border-4">
        <i class="fas fa-ban me-2 text-danger"></i>
        <strong>Quit:</strong> Stop smoking, limit alcohol
    </div>
</div>
{% endif %}

<!-- General Tips -->
<div class="bg-body-tertiary rounded-3 p-4 mt-4">
    <h6 class="fw-bold mb-3">
        <i class="fas fa-lightbulb me-2" style="color: #0066FF;"></i>
        General Heart Health
    </h6>
    <div class="row">
        <div class="col-md-6">
            <ul class="list-unstyled small text-body">
                <li class="mb-2">• Limit sodium &lt;2,300mg/day</li>
                <li class="mb-2">• Omega-3 foods (fish, walnuts)</li>
                <li class="mb-2">• Manage stress (meditation, yoga)</li>
                <li class="mb-2">• Stay hydrated</li>
            </ul>
        </div>
        <div class="col-md-6">
            <ul class="list-unstyled small text-body">
                <li class="mb-2">• Avoid trans fats</li>
                <li class="mb-2">• Social connections</li>
                <li class="mb-2">• Control diabetes</li>
                <li class="mb-2">• Take medications consistently</li>
            </ul>
        </div>
    </div>
</div>

<!-- Emergency -->
<div class="alert alert-info mt-4 mb-0" role="alert">
    <h6 class="fw-bold"><i class="fas fa-exclamation-triangle me-2"></i>Emergency Signs</h6>
    <p class="small mb-2">Seek immediate help if experiencing:</p>
    <p class="small mb-0">
        Chest pain • Shortness of breath • Arm/back/neck pain • Cold sweat • Nausea • Dizziness
    </p>
</div>
</div>
</div>

<!-- Disclaimer -->
<div class="alert alert-warning" role="alert">
    <h6 class="fw-bold text-warning">
        <i class="fas fa-info-circle me-2"></i>
        Important Disclaimer
    </h6>
    <p class="small mb-0">
        For educational purposes only. NOT a substitute for professional medical advice. Always consult your physician.
    </p>
</div>

<!-- Actions -->
<div class="text-center mb-4">
    <a href="/predict" class="btn btn-outline-secondary btn-lg me-2 px-4">
        <i class="fas fa-redo me-2"></i>New Analysis
    </a>
    <a href="/" class="btn btn-primary btn-lg px-4">
        <i class="fas fa-home me-2"></i>Home
    </a>
</div>

{% endblock %}